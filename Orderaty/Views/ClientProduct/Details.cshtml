@model Orderaty.Models.Product
@{
    ViewData["Title"] = Model.Name;
}

<link rel="stylesheet" href="~/css/client-product-details.css" />

<div class="product-details container py-5">
    <div class="row g-5">
        <!-- Product Image -->
        <div class="col-md-5">
            <div class="product-image shadow rounded-4 overflow-hidden">
                <img src="@(string.IsNullOrEmpty(Model.Image) ? "/images/no-image.png" : Model.Image)"
                     alt="@Model.Name" class="img-fluid w-100" style="object-fit: cover; height: 400px;" />
            </div>
        </div>

        <!-- Product Info -->
        <div class="col-md-7">
            <h2 class="fw-bold mb-3">@Model.Name</h2>

            <!-- Rating -->
            <div class="d-flex align-items-center mb-3">
                @for (int i = 1; i <= 5; i++)
                {
                    if (i <= Model.Rating)
                    {
                        <i class="fas fa-star text-warning me-1"></i>
                    }
                    else
                    {
                        <i class="far fa-star text-muted me-1"></i>
                    }
                }
                <span class="text-muted ms-2 small">(@Model.Rating.ToString("0.0"))</span>
            </div>

            <!-- Price -->
            <h4 class="text-primary fw-bold mb-3">$@Model.Price.ToString("0.00")</h4>

            <!-- Description -->
            <p class="text-muted mb-4">@Model.Description</p>

            <!-- Quantity -->
            <div class="mb-3">
                <span class="fw-semibold">Available Quantity:</span>
                <span class="text-success fw-bold">@Model.Available_Amount</span>
            </div>

            <!-- Add to cart -->
            <div class="d-flex align-items-center gap-3">
                <input type="number" id="quantity" class="form-control w-auto rounded-pill"
                       min="1" value="1" max="@Model.Available_Amount" />
                <button class="btn btn-primary rounded-pill px-4" onclick="addToCart(@Model.Id)">
                    <i class="fas fa-cart-plus me-2"></i> Add to Cart
                </button>
            </div>

            <hr class="my-4" />

            <!-- Seller Info -->
            <div class="seller-info d-flex align-items-center">
                <img src="@(string.IsNullOrEmpty(Model.Seller?.User?.Image) ? "/images/default-user.png" : Model.Seller.User.Image)"
                     alt="@Model.Seller?.User?.FullName"
                     class="rounded-circle border shadow-sm me-3"
                     style="width: 60px; height: 60px; object-fit: cover;" />
                <div>
                    <h6 class="mb-1 fw-semibold">@Model.Seller?.User?.FullName</h6>
                    <small class="text-muted">@Model.Seller?.Category.ToString().Replace("_", " ")</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Reviews -->
    <div class="reviews-section mt-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="h4">Customer Reviews</h2>
            <a href="#" class="btn btn-outline-primary btn-sm rounded-pill">
                <i class="fas fa-pen me-1"></i> Write a Review
            </a>
        </div>

        <p class="text-muted fst-italic">
            No reviews yet. Be the first to review this product.
        </p>
    </div>
</div>

@section Scripts {
    <script>
        function addToCart(productId) {
            const quantity = parseInt(document.getElementById("quantity").value);
            if (quantity <= 0 || isNaN(quantity)) {
                alert("Please enter a valid quantity.");
                return;
            }

            fetch(`/Cart/AddToCart?id=${productId}&quantity=${quantity}`, {
                method: 'POST'
            })
                .then(res => {
                    if (res.ok) {
                        alert("✅ Product added to cart successfully!");
                    } else {
                        alert("❌ Failed to add product to cart.");
                    }
                })
                .catch(() => alert("⚠️ Something went wrong."));
        }
    </script>
}
