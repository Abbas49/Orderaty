@model Orderaty.ViewModels.StoresProducts
@{
    ViewData["Title"] = "Home Page";
}

@section Styles {
    <link rel="stylesheet" href="~/css/home.css" asp-append-version="true" />
    <style>
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 1.25rem 1.5rem;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
            z-index: 9999;
            min-width: 350px;
            max-width: 450px;
            animation: slideInRight 0.4s ease-out;
        }

        .toast-notification i {
            font-size: 1.75rem;
            flex-shrink: 0;
        }

        .toast-notification .message-content {
            flex: 1;
        }

        .toast-notification .message-title {
            font-weight: 700;
            font-size: 1.05rem;
            margin-bottom: 0.35rem;
        }

        .toast-notification .message-text {
            font-size: 0.9rem;
            opacity: 0.95;
            line-height: 1.4;
        }

        .toast-notification .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
            flex-shrink: 0;
        }

        .toast-notification .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .toast-notification.fade-out {
            animation: fadeOut 0.3s ease-out forwards;
        }

        @@keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @@keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }

        @@media (max-width: 768px) {
            .toast-notification {
                top: 10px;
                right: 10px;
                left: 10px;
                min-width: auto;
                max-width: none;
            }
        }
    </style>
}

<!-- Hero Section -->
<section class="hero">
    <div class="container">
        <div class="hero-grid">
            <!-- Left Column - Content -->
            <div class="hero-content">
                <h1 class="hero-title">
                    Your Favorite <span class="hero-title-highlight">Stores</span><br>
                    Delivered Fast
                </h1>
                <p class="hero-subtitle">
                    From restaurants to pharmacies, groceries to electronics - get everything delivered to your doorstep in minutes, not hours.
                </p>

                <!-- Feature Badges -->
                <div class="hero-features">
                    <div class="hero-feature-badge">
                        <i class="fas fa-clock"></i>
                        <span>30 min delivery</span>
                    </div>
                    <div class="hero-feature-badge">
                        <i class="fas fa-shield-alt"></i>
                        <span>Safe & secure</span>
                    </div>
                    <div class="hero-feature-badge">
                        <i class="fas fa-star"></i>
                        <span>4.8 rating</span>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="hero-actions">
                    <a href="/Seller/Browse" class="hero-btn hero-btn-primary">
                        <i class="fas fa-shopping-bag"></i>
                        Order Now
                    </a>
                </div>
            </div>

            <!-- Right Column - Category Cards -->
            <div class="hero-categories">
                <a href="/Seller/Browse?category=Food_Restaurants" class="hero-category-card hero-category-food">
                    <div class="hero-category-icon">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <div class="hero-category-info">
                        <h3 class="hero-category-title">Food Delivery</h3>
                        <p class="hero-category-subtitle">2000+ restaurants</p>
                    </div>
                </a>

                <a href="/Seller/Browse?category=Groceries_Supermarkets" class="hero-category-card hero-category-groceries">
                    <div class="hero-category-icon">
                        <i class="fas fa-shopping-basket"></i>
                    </div>
                    <div class="hero-category-info">
                        <h3 class="hero-category-title">Groceries</h3>
                        <p class="hero-category-subtitle">Fresh & organic</p>
                    </div>
                </a>

                <a href="/Seller/Browse?category=Pharmacy_Health" class="hero-category-card hero-category-pharmacy">
                    <div class="hero-category-icon">
                        <i class="fas fa-pills"></i>
                    </div>
                    <div class="hero-category-info">
                        <h3 class="hero-category-title">Pharmacy</h3>
                        <p class="hero-category-subtitle">24/7 medicine delivery</p>
                    </div>
                </a>

                <a href="/Seller/Browse?category=Electronics_Mobile" class="hero-category-card hero-category-electronics">
                    <div class="hero-category-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <div class="hero-category-info">
                        <h3 class="hero-category-title">Electronics</h3>
                        <p class="hero-category-subtitle">Latest gadgets</p>
                    </div>
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Featured Stores Section -->
<section class="featured-stores">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Featured Stores</h2>
            <a href="/Seller/Browse" class="view-all-btn">
                View All
                <i class="fas fa-arrow-right"></i>
            </a>
        </div>
        <div class="stores-grid">
            @foreach(var store in Model.Sellers)
            {
                <a href="@Url.Action("Details", "Seller", new { id = store.Id })" class="store-card">
                    <div class="store-image">
                        <img src="~/images/users/@store.User.Image" alt="Fresh Market grocery store interior with fresh produce">
                        <button class="add-to-favorites" onclick="event.preventDefault(); event.stopPropagation(); MakeFavourite(this, '@store.User.Id')">
                            @inject Orderaty.Data.AppDbContext DbContext
                            @{
                                var currentUserId = DbContext.Users.FirstOrDefault(c => c.UserName == User.Identity.Name)?.Id;
                            }
                            @if (store.Favourites.Any(u => u.ClientId == currentUserId && u.IsFavourite))
                            {
                                <i class="fas fa-heart"></i>
                            }
                            else
                            {
                                <i class="far fa-heart"></i>
                            }
                        </button>
                    </div>
                    <div class="store-info">
                        <div class="store-badge">@store.Category.ToString()</div>
                        <h3 class="store-title">@store.User.FullName</h3>
                        <div class="store-meta">
                            <span class="rating">⭐ @store.Rating</span>
                            <span class="eta">20-30 min</span>
                        </div>
                    </div>
                </a>
            }
        </div>
    </div>
</section>

<!-- Trending Items Section -->
<section class="trending-items">
    <div class="container">
        <div class="section-header">
            <h2 class="section-title">Trending Items</h2>
            <a href="/ClientProduct/Index" class="view-all-btn">
                View All
                <i class="fas fa-arrow-right"></i>
            </a>
        </div>
        <div class="products-grid">
            @foreach(var product in Model.Products)
            {
                <div class="product-card">
                    <a href="@Url.Action("Details", "ClientProduct", new { id = product.Id })" class="product-link">
                        <div class="product-image">
                            <img src="~/images/products/@product.Image" alt="@product.Name">
                            @*<button class="add-to-favorites" onclick="event.preventDefault(); event.stopPropagation();">
                                <i class="far fa-heart"></i>
                            </button>*@
                        </div>
                        <div class="product-info">
                            @*<div class="product-category">@product</div>*@
                            <h3 class="product-title">@product.Name</h3>
                            <p class="product-store">@product.Seller.User.FullName</p>
                            <div class="product-footer">
                                <div class="product-price">
                                    <span class="price">@product.Price EGP</span>
                                </div>
                                <button class="add-to-cart-btn" onclick="event.preventDefault(); event.stopPropagation(); AddToCart(@product.Id)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </a>
                </div>
            }
        </div>
    </div>
</section>

<!-- Browse Categories Section -->
<section class="browse-categories">
    <div class="container">
        <h2 class="section-title">Browse Categories</h2>
        <div class="categories-grid">
            <div class="category-item">
                <a href="/Seller/Browse?category=Groceries_Supermarkets">
                <div class="category-icon groceries">
                    <i class="fas fa-shopping-bag" ></i>
                </div>
                </a>
                <span class="category-label">Groceries</span>
            </div>

            <div class="category-item">
                <a href="/Seller/Browse?category=Food_Restaurants">
                <div class="category-icon restaurants">
                    <i class="fas fa-utensils"></i>
                </div>
                </a>
                <span class="category-label">Restaurants</span>
            </div>

            <div class="category-item">
                <a href="/Seller/Browse?category=Electronics_Mobile">
                <div class="category-icon food">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                </a>
                <span class="category-label">Electronics & Mobile</span>
            </div>
            
            <div class="category-item">
                <a href="/Seller/Browse?category=Pharmacy_Health">
                <div class="category-icon pharmacy">
                    <i class="fas fa-prescription-bottle"></i>
                </div>
                </a>
                <span class="category-label">Pharmacy</span>
            </div>
            
            <div class="category-item">
                <a href="/Seller/Browse?category=Fashion_Clothing">
                <div class="category-icon packages">
                    <i class="fas fa-tshirt"></i>
                </div>
                </a>
                <span class="category-label">Fashion & Clothing</span>
            </div>
            
            
            
            <div class="category-item">
                <a href="/Seller/Browse?category=Home_Furniture">
                <div class="category-icon coffee">
                    <i class="fas fa-couch"></i>
                </div>
                </a>
                <span class="category-label">Home & Furniture</span>
            </div>

        </div>
    </div>
</section>

@section Scripts {
    <script>
        function MakeFavourite(btn, sellerId){
            var icon = $(btn).find("i");
            $.ajax(
                {
                    url: "/Favourite/Make?sellerId="+sellerId,
                    // data : {id : empId},
                    type : "POST",
                    success: function(result){
                        console.log(result)
                        if (result === false) {
                            icon.removeClass("fas").addClass("far").css("color", "");
                        }
                        else {
                            icon.removeClass("far").addClass("fas").css("color", "white");
                        }
                    }
                } 
            );
        }


        function AddToCart(productId){
            $.ajax({
                url: '/Cart/Add?id='+productId+'&quantity=1',
                type: 'POST',
                //data: { productId: productId },
                success: function (response) {
                if (response.success) {
                    document.getElementById('cart-count').textContent = response.cartCount;
                    showToast('Item Added to Cart!', 'Product successfully added to your cart.');
                } else {
                    alert('Error: ' + response.message);
                }
            },
            error: function () {
                alert('Failed to add item to cart.');
            }
        });
        }

        function showToast(title, message) {
            // Remove any existing toast
            const existingToast = document.getElementById('successToast');
            if (existingToast) {
                existingToast.remove();
            }

            // Create toast element
            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            toast.id = 'successToast';
            toast.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <div class="message-content">
                    <div class="message-title">${title}</div>
                    <div class="message-text">${message}</div>
                </div>
                <button class="close-btn" onclick="closeToast()">
                    <i class="fas fa-times"></i>
                </button>
            `;

            // Add toast to body
            document.body.appendChild(toast);

            // Auto-dismiss after 5 seconds
            setTimeout(function() {
                closeToast();
            }, 5000);
        }

        function closeToast() {
            const toast = document.getElementById('successToast');
            if (toast) {
                toast.classList.add('fade-out');
                setTimeout(function() {
                    toast.remove();
                }, 300);
            }
        }
    </script>
}