@model Orderaty.Models.Coupon

@{
    ViewData["Title"] = "Create Coupon";
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin-dashboard.css" asp-append-version="true" />
}

<!-- Page Header -->
<section class="page-header">
    <div class="container">
        <div class="header-content">
            <div class="page-title-section">
                <h1 class="page-title">
                    <i class="fas fa-plus-circle"></i>
                    Create New Coupon
                </h1>
                <p class="page-subtitle">Add a new discount coupon to the platform</p>
            </div>
            <div class="header-actions">
                <a asp-action="Coupons" class="action-btn btn-secondary">
                    <i class="fas fa-arrow-left"></i>
                    Back to Coupons
                </a>
            </div>
        </div>
    </div>
</section>

<!-- Create Coupon Form -->
<section class="form-section">
    <div class="container">
        <div class="form-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-ticket-alt"></i>
                    Coupon Details
                </h2>
            </div>
            <div class="card-content">
                <form asp-action="CreateCoupon" method="post" class="coupon-form">
                    <div asp-validation-summary="All" class="validation-summary"></div>
                    <div class="form-grid">
                        <!-- Coupon Code -->
                        <div class="form-group full-width">
                            <label asp-for="Code" class="form-label">
                                <i class="fas fa-tag"></i>
                                Coupon Code
                                <span class="required">*</span>
                            </label>
                            <input asp-for="Code" class="form-input" placeholder="e.g., SAVE20, SUMMER2025" required>
                            <span asp-validation-for="Code" class="text-danger"></span>
                            <small class="form-help">Use uppercase letters and numbers. No spaces allowed.</small>
                        </div>

                        <!-- Discount Value -->
                        <div class="form-group">
                            <label asp-for="DiscountValue" class="form-label">
                                <i class="fas fa-dollar-sign"></i>
                                Discount Value
                                <span class="required">*</span>
                            </label>
                            <input asp-for="DiscountValue" class="form-input" placeholder="20.00" step="0.01" min="0" required>
                            <span asp-validation-for="DiscountValue" class="text-danger"></span>
                            <small class="form-help">Fixed discount amount in dollars.</small>
                        </div>

                        <!-- Minimum Total -->
                        <div class="form-group">
                            <label asp-for="MinimumTotal" class="form-label">
                                <i class="fas fa-shopping-cart"></i>
                                Minimum Order Total
                                <span class="required">*</span>
                            </label>
                            <input asp-for="MinimumTotal" class="form-input" placeholder="100.00" step="0.01" min="0" required>
                            <span asp-validation-for="MinimumTotal" class="text-danger"></span>
                            <small class="form-help">Minimum order value to use this coupon.</small>
                        </div>

                        <!-- Expire Date -->
                        <div class="form-group">
                            <label asp-for="ExpireDate" class="form-label">
                                <i class="fas fa-calendar"></i>
                                Expiration Date
                                <span class="required">*</span>
                            </label>
                            <input asp-for="ExpireDate" type="date" class="form-input" required>
                            <span asp-validation-for="ExpireDate" class="text-danger"></span>
                            <small class="form-help">When this coupon will expire.</small>
                        </div>

                        <!-- Is Active -->
                        <div class="form-group">
                            <label asp-for="IsActive" class="form-label">
                                <i class="fas fa-toggle-on"></i>
                                Status
                            </label>
                            <div class="toggle-group">
                                <input asp-for="IsActive" type="checkbox" class="toggle-checkbox" checked>
                                <label for="IsActive" class="toggle-label">
                                    <span class="toggle-text">Active</span>
                                </label>
                            </div>
                            <small class="form-help">Enable or disable this coupon.</small>
                        </div>
                    </div>

                    <!-- Preview Card -->
                    <div class="coupon-preview">
                        <div class="preview-header">
                            <i class="fas fa-eye"></i>
                            <span>Coupon Preview</span>
                        </div>
                        <div class="preview-coupon">
                            <div class="preview-code">
                                <i class="fas fa-ticket-alt"></i>
                                <span id="previewCode">YOUR CODE</span>
                            </div>
                            <div class="preview-details">
                                <div class="preview-item">
                                    <span class="preview-label">Discount:</span>
                                    <span class="preview-value" id="previewDiscount">$0.00</span>
                                </div>
                                <div class="preview-item">
                                    <span class="preview-label">Min. Order:</span>
                                    <span class="preview-value" id="previewMinimum">$0.00</span>
                                </div>
                                <div class="preview-item">
                                    <span class="preview-label">Valid Until:</span>
                                    <span class="preview-value" id="previewExpire">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="submit" class="btn-submit">
                            <i class="fas fa-check"></i>
                            Create Coupon
                        </button>
                        <a asp-action="Coupons" class="btn-cancel">
                            <i class="fas fa-times"></i>
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('ExpireDate').setAttribute('min', today);
        
        // Coupon preview update
        document.getElementById('Code').addEventListener('input', function(e) {
            document.getElementById('previewCode').textContent = e.target.value || 'YOUR CODE';
        });
        
        document.getElementById('DiscountValue').addEventListener('input', function(e) {
            const value = parseFloat(e.target.value) || 0;
            document.getElementById('previewDiscount').textContent = '$' + value.toFixed(2);
        });
        
        document.getElementById('MinimumTotal').addEventListener('input', function(e) {
            const value = parseFloat(e.target.value) || 0;
            document.getElementById('previewMinimum').textContent = '$' + value.toFixed(2);
        });
        
        document.getElementById('ExpireDate').addEventListener('input', function(e) {
            const date = e.target.value ? new Date(e.target.value).toLocaleDateString() : '-';
            document.getElementById('previewExpire').textContent = date;
        });
    </script>
}
